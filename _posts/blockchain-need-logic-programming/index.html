
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.17">
    
    
      
        <title>区块链需要逻辑编程 - rink1969@home</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.bcfcd587.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#logic-programming" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="rink1969@home" class="md-header__button md-logo" aria-label="rink1969@home" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            rink1969@home
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              区块链需要逻辑编程
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="rink1969@home" class="md-nav__button md-logo" aria-label="rink1969@home" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    rink1969@home
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    博客
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    关于我
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#logic-programming" class="md-nav__link">
    <span class="md-ellipsis">
      logic programming
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      对于区块链的意义
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#linear-logic-programming" class="md-nav__link">
    <span class="md-ellipsis">
      linear logic programming
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ceptre" class="md-nav__link">
    <span class="md-ellipsis">
      Ceptre的例子
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cell-modeldapp" class="md-nav__link">
    <span class="md-ellipsis">
      Cell Model下Dapp架构
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>区块链需要逻辑编程</h1>

<h3 id="logic-programming">logic programming</h3>
<p>逻辑编程有两个特点：</p>
<ol>
<li>不区分输入和输出。可以正向计算，也可以反向计算。</li>
<li>可以处理不确定的情况。就像解代数方程一样，如果只有一个解，会输出这个解；如果有多个解，会把所有的解都找出来，当然用户也可以控制，找到任何一个解的时候就停下来。</li>
</ol>
<h3 id="_1">对于区块链的意义</h3>
<p>尤其是对于Cell Model来说，非常适合，参见<a href="https://github.com/rink1969/ckb-generator/blob/master/README.md">文章</a>。</p>
<p>对于第一点，很多时候，确实是需要从输出来反向计算输入的。比如转账，我们是先确定输出里转账的金额，然后据此才能去查找live cell作为交易的输入。</p>
<p>对于第二点，继续上面的例子，查找live cell的时候肯定有很多种组合可以满足要求。我们可以把所有可能的结果都列出来，然后再附加其他限制；也可以简单一点，找到任意一个结果就可以了。</p>
<h3 id="linear-logic-programming">linear logic programming</h3>
<p>在之前逻辑编程的基础上增加linear logic的限制。</p>
<p>下面是一些学习的笔记：</p>
<hr />
<p><a href="https://www.infoq.com/presentations/linear-logic-programming/">linear logic programming</a></p>
<p>linear logic programming与logic programming。</p>
<p>logic programming 首先有一些规则，然后用户来query一个问题的答案。</p>
<p>关键的一点是locally stateful computation。或者叫frame property。感觉就是前面说的运动中的一帧。</p>
<p>purely functional 把世界状态作为参数传给函数，然后生成新的世界状态。</p>
<p>imperative 直接修改替换状态</p>
<p>linear logic programming 是一种声明式的，high level，更贴近领域语言</p>
<p>logic programming proof search is execution。</p>
<p>反复应用规则，直到找到用户想要查询的答案，同时给出proof，也就是路径。</p>
<p>backward chaining 从目标开始一步一步往回搜索，拆分出一些子任务，直到子任务显然成立。prolog就是这种方法。</p>
<p>forward chaining 从已经得到的结论开始，类似广度优先搜索，直到碰到目标。</p>
<p>如前所述，很多逻辑编程语言都使用backward chaining。</p>
<p>为什么要关注forward chaining，因为想modeling evolving system</p>
<p>rules和proposition是等价的</p>
<p>quiescence 无法再应用任何一条规则的状态</p>
<p>存在不确定性，比如排序，先交换哪两个数字都是可以的。</p>
<hr />
<p><a href="https://www.youtube.com/watch?v=bFeJZRdhKcI">Ceptre: A Language for Modeling Generative Interactive Systems</a></p>
<p>针对复杂规则的游戏进行原型验证</p>
<p>模拟游戏</p>
<p>类似mud的游戏，通过输入命令，改变隐含的世界模型</p>
<p>interactive worlds 由 initial configuration（玩家的状态）和一些rules for evolving configurations（buffing增加玩家的攻击力）组成。其中一些规则用来调度用户交互，随机和其他的一些处理。</p>
<p>logic</p>
<p>facts about the world are propositions。</p>
<p>可以写成predicates</p>
<p>action and change</p>
<p>最基本的一点是在玩家的动作下，世界的facts如何随着时间发生改变。</p>
<p>可以形式化为linear logic的implication</p>
<p>tenser conjoin two propositions</p>
<p>！表示可访问多次（不同的颜色表示是否可以多次访问）</p>
<p>A * $B -&gt; C  等于 A * B -&gt; C * B</p>
<p>linear logic Programming</p>
<p>Congifuration（linear context）一些属性列表</p>
<p>Signature（permanent rules）</p>
<p>multi set rewriting    forward chaining</p>
<p>run program  = 从init开始应用规则，形成一个trace</p>
<p>直到没有规则可以再应用</p>
<p>这里有不确定性</p>
<p>interactivity</p>
<p>一个方法是把所有可能选项列出来，让用户选择并输入序号</p>
<p>但是玩家是分队对抗的</p>
<p>而现在的选项是混在一起的</p>
<p>引入stage</p>
<p>有点像是一个回合游戏里面，维持当前轮到谁的机制</p>
<p>跳出到runtime进行调度的机制</p>
<p>交互就增加到中间调度的时候</p>
<p>case studies</p>
<p>Narrative Generation</p>
<p>Multi-agent interactive social simulation</p>
<p>RPG</p>
<p>桌游</p>
<p>Fuzzing in game</p>
<p>没太大意义，可以做一些ai，统计等</p>
<p>进行一些平衡性的调整</p>
<p>关于规则的设计，Invariants非常重要，规则要保证这些不变量</p>
<p>INV holkds for a specification iff INV holds of all initial configurations and for all rules A -&gt; B</p>
<p>if INV holds of A,contexts then INV holds of B,contexts</p>
<p>一个好的方法是使用linear logic（有点像libra的想法）</p>
<p>Lessons for PL Design</p>
<p>Logical Basis 逻辑是一个很好的中间语言，在人的思考和机器的中间</p>
<p>minimalism</p>
<p>逐渐修正</p>
<h3 id="ceptre">Ceptre的例子</h3>
<p><a href="https://github.com/chrisamaphone/interactive-lp">项目仓库</a>，README里面有预编译binary的下载链接。</p>
<p>写了一个简单的两个用户转账的例子。</p>
<p>编辑<code>transfer.cep</code>包含如下内容：</p>
<pre><code>cell : type.
key : type.
user : type.

locked key cell : pred.
control user key : pred.

stage transfer = {
transfer
  : locked K C * control U K * control U1 K1 -o locked K1 C * control U K * control U1 K1.
}
#interactive transfer.

alice : user.
bob : user.

alice_key : key.
bob_key : key.

c : cell.

context init =
{ control alice alice_key, control bob bob_key, locked alice_key c }


#trace _ transfer init.
</code></pre>
<p>运行结果：</p>
<pre><code>$ ceptre transfer.cep 
Ceptre!
cell: type.
key: type.
user: type.
locked key cell: pred.
control user key: pred.
stage transfer {
forward chaining rule transfer with 5 free variables...
}
#interactive transfer.
alice: user.
bob: user.
alice_key: key.
bob_key: key.
c: cell.
context init { (control alice alice_key), (control bob bob_key), (locked alice_key c) }
#trace ...

0: (quiesce)
1: (transfer alice_key c alice bob bob_key)
?- 1

0: (quiesce)
1: (transfer bob_key c bob alice alice_key)
?- 1

0: (quiesce)
1: (transfer alice_key c alice bob bob_key)
?- 0


Final state:
{(control alice alice_key), (control bob bob_key), (locked alice_key c), (stage transfer)}

Trace: 
let [x6, x5, x4] = transfer alice_key c alice bob bob_key [x3, [x1, [x2, []]]];
let [x9, x8, x7] = transfer bob_key c bob alice alice_key [x4, [x6, [x5, []]]];
</code></pre>
<p>整个运行过程是交互式的命令行的方式。</p>
<p>我们可以看到需要用户操作时，系统都会列出所有当前可以进行的操作的列表。</p>
<p>特别需要注意的是，系统会根据规则以及相关的类型自动匹配参数。</p>
<p>因为在我们的初始配置里是alice拥有一个cell，所以第一次transfer，系统自动就判断出可能的操作是alice给bob转账。</p>
<p>而转账之后，cell的所有权转移给了bob。接下来系统的提示就变成了bob给alice转账。</p>
<p>这个是逻辑编程里的unify特性，再辅以linear logic对物品所有权的感知。能够帮助用户做很多推理，去除一些无意义的选项，简化用户的负担。</p>
<p>这个对于Cell Model在用户交互层面会非常有用。</p>
<h3 id="cell-modeldapp">Cell Model下Dapp架构</h3>
<p>目前ckb-generator没有达到预期的效果，但是其中采用的合约组件的方式证明是可行的。</p>
<p>只不过组件生态如果比较成熟，用户只需要简单的进行组件的组合，就不需要DSL了。</p>
<hr />
<p>整个Dapp如<a href="https://rink1969.github.io/Linear-Logic-FRP">上篇文章</a>所说，采用FRP，或者说嵌套MVC架构。</p>
<p>SDK负责屏蔽链交互相关的信息，解析出Json格式的数据。</p>
<p>logic porgramming这一层负责Dapp业务规则相关的推理，根据用户操作，给出结果，或者给出用户当前可以做的操作的列表。</p>
<p>最后是GUI，以用户友好的方式展示相关信息，以及各种复杂的用户输入。</p>
<hr />
<p>Cell Model的一个特点是输入输出都是确定的。</p>
<p>再加上前述逻辑编程的特点。</p>
<p>如果事先把Dapp相关的资源单独隔离出来，保证Dapp运行期间这些资源不会被消费掉。</p>
<p>将这些资源作为初始配置输入逻辑编程环境，那么用户就可以任意的操作或者回退。</p>
<p>比如像HTLC的例子，Cell Model可以做到交易没上链之前就得到其交易Hash，并据此构造后续的交易。</p>
<p>只有到了不得不跟链交互的时候，经过反复确认，再把相关交易一起提交上链。</p>
<hr />
<p>这样就有点侧链的感觉。</p>
<p>或者说像是git里拉了一个分支，用户可以在分支上任意的修改，回退再修改，最后merge回主分支。</p>
<p>这印证了<a href="https://rink1969.github.io/Linear-Logic-Everywhere">之前的文章</a>所说，POW是解决多条子链（分支）合并，并解决其可能出现的冲突的。</p>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.1e8ae164.min.js"></script>
      
        <script src="../../search/main.js"></script>
      
    
  </body>
</html>